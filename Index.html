<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to PDF Converter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HTML2PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* Custom Scrollbar for the editor */
        textarea::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        textarea::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        textarea::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        textarea::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }

        /* Paper Preview Styling to mimic A4 */
        .a4-paper {
            width: 210mm;
            min-height: 297mm;
            padding: 0;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
            overflow: hidden;
            color: black;
        }
        
        /* Mobile adjustment for preview */
        @media (max-width: 768px) {
            .a4-paper {
                width: 100%;
                min-height: auto;
            }
        }

        /* Spinner Animation */
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top: 3px solid white;
            width: 20px;
            height: 20px;
            -webkit-animation: spin 1s linear infinite; /* Safari */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 h-screen flex flex-col overflow-hidden font-sans">

    <!-- Header -->
    <header class="bg-gray-800 border-b border-gray-700 p-4 flex justify-between items-center shadow-md z-10">
        <div class="flex items-center space-x-2">
            <i data-lucide="file-type-2" class="text-blue-400 w-8 h-8"></i>
            <h1 class="text-xl font-bold tracking-tight">HTML<span class="text-blue-400">2</span>PDF</h1>
        </div>
        <div class="flex items-center space-x-3">
            <button onclick="loadTemplate()" class="hidden md:flex items-center px-3 py-1.5 text-sm bg-gray-700 hover:bg-gray-600 rounded-md transition border border-gray-600">
                <i data-lucide="layout-template" class="w-4 h-4 mr-2"></i> Reset Template
            </button>
            <button id="downloadBtn" onclick="generatePDF()" class="flex items-center px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-md font-medium shadow-lg transition transform hover:scale-105">
                <span id="btnText" class="flex items-center">
                    <i data-lucide="download" class="w-4 h-4 mr-2"></i> Download PDF
                </span>
                <div id="btnSpinner" class="spinner ml-2 hidden"></div>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col lg:flex-row overflow-hidden">
        
        <!-- Left Panel: Editor & Settings -->
        <div class="w-full lg:w-1/2 flex flex-col border-r border-gray-700 bg-gray-900">
            
            <!-- Toolbar -->
            <div class="p-3 bg-gray-800 border-b border-gray-700 grid grid-cols-2 md:grid-cols-4 gap-3">
                <div>
                    <label class="block text-xs text-gray-400 mb-1">Filename</label>
                    <input type="text" id="filename" value="document.pdf" class="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 mb-1">Margin (mm)</label>
                    <input type="number" id="margin" value="10" min="0" max="50" class="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none" onchange="updatePreviewStyle()">
                </div>
                <div>
                    <label class="block text-xs text-gray-400 mb-1">Orientation</label>
                    <select id="orientation" class="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none">
                        <option value="portrait">Portrait</option>
                        <option value="landscape">Landscape</option>
                    </select>
                </div>
                <div>
                    <label class="block text-xs text-gray-400 mb-1">Paper Size</label>
                    <select id="format" class="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm focus:border-blue-500 outline-none">
                        <option value="a4">A4</option>
                        <option value="letter">Letter</option>
                        <option value="legal">Legal</option>
                    </select>
                </div>
            </div>

            <!-- Code Editor -->
            <div class="flex-1 relative group">
                <textarea id="htmlInput" class="w-full h-full bg-[#1e1e1e] text-gray-300 font-mono text-sm p-4 outline-none resize-none" spellcheck="false" placeholder="Enter your HTML here..."></textarea>
                <div class="absolute bottom-4 right-4 text-xs text-gray-500 bg-gray-800 px-2 py-1 rounded opacity-50 group-hover:opacity-100 transition">
                    Raw HTML Editor
                </div>
            </div>
        </div>

        <!-- Right Panel: Preview -->
        <div class="w-full lg:w-1/2 bg-gray-200 overflow-auto p-4 md:p-8 flex justify-center relative">
            <div class="absolute top-4 left-4 z-0 text-gray-400 font-bold text-6xl opacity-5 pointer-events-none uppercase tracking-widest">Preview</div>
            
            <!-- The Paper (Target for PDF) -->
            <div id="preview-container" class="a4-paper bg-white text-black transition-all duration-300 ease-in-out">
                <!-- Content injected here -->
            </div>
        </div>
    </main>

    <script>
        // --- Configuration ---
        const initialTemplate = `
<div style="font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; padding: 40px; color: #333;">
    
    <!-- Header -->
    <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 30px;">
        <div>
            <h1 style="font-size: 32px; font-weight: bold; color: #2563eb; margin: 0;">INVOICE</h1>
            <p style="font-size: 14px; color: #666; margin-top: 5px;">#INV-2023-001</p>
        </div>
        <div style="text-align: right;">
            <h2 style="font-size: 20px; font-weight: bold; margin: 0;">Acme Corp.</h2>
            <p style="margin: 5px 0 0; font-size: 12px; color: #666;">
                123 Innovation Drive<br>
                Tech Valley, CA 94043<br>
                contact@acme.com
            </p>
        </div>
    </div>

    <!-- Bill To / Ship To -->
    <div style="display: flex; margin-bottom: 40px;">
        <div style="flex: 1;">
            <h3 style="font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 10px;">Bill To</h3>
            <p style="margin: 0; font-weight: bold;">John Doe</p>
            <p style="margin: 0; font-size: 14px; color: #555;">
                456 Pine Street<br>
                Seattle, WA 98101<br>
                john.doe@example.com
            </p>
        </div>
        <div style="flex: 1; text-align: right;">
            <h3 style="font-size: 12px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 10px;">Details</h3>
            <p style="margin: 0; font-size: 14px;"><strong>Date:</strong> Oct 24, 2023</p>
            <p style="margin: 0; font-size: 14px;"><strong>Due Date:</strong> Nov 24, 2023</p>
        </div>
    </div>

    <!-- Table -->
    <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
        <thead>
            <tr style="background-color: #f8fafc; border-bottom: 2px solid #e2e8f0;">
                <th style="text-align: left; padding: 12px; font-size: 12px; text-transform: uppercase; color: #64748b;">Description</th>
                <th style="text-align: right; padding: 12px; font-size: 12px; text-transform: uppercase; color: #64748b;">Qty</th>
                <th style="text-align: right; padding: 12px; font-size: 12px; text-transform: uppercase; color: #64748b;">Price</th>
                <th style="text-align: right; padding: 12px; font-size: 12px; text-transform: uppercase; color: #64748b;">Total</th>
            </tr>
        </thead>
        <tbody>
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 12px; font-size: 14px;"><strong>Web Development Services</strong><br><span style="color: #666; font-size: 12px;">Frontend Architecture Implementation</span></td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">40</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$150.00</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$6,000.00</td>
            </tr>
            <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 12px; font-size: 14px;"><strong>UI/UX Design</strong><br><span style="color: #666; font-size: 12px;">Mobile App Prototyping</span></td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">20</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$120.00</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$2,400.00</td>
            </tr>
             <tr style="border-bottom: 1px solid #e2e8f0;">
                <td style="padding: 12px; font-size: 14px;"><strong>Server Maintenance</strong><br><span style="color: #666; font-size: 12px;">Annual Checkup</span></td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">1</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$500.00</td>
                <td style="text-align: right; padding: 12px; font-size: 14px;">$500.00</td>
            </tr>
        </tbody>
    </table>

    <!-- Totals -->
    <div style="display: flex; justify-content: flex-end;">
        <div style="width: 250px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #666;">
                <span>Subtotal:</span>
                <span>$8,900.00</span>
            </div>
             <div style="display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; color: #666;">
                <span>Tax (10%):</span>
                <span>$890.00</span>
            </div>
            <div style="display: flex; justify-content: space-between; border-top: 2px solid #2563eb; padding-top: 10px; margin-top: 10px; font-weight: bold; font-size: 18px;">
                <span>Total:</span>
                <span style="color: #2563eb;">$9,790.00</span>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <div style="margin-top: 60px; padding-top: 20px; border-top: 1px solid #eee; text-align: center; color: #999; font-size: 12px;">
        <p>Thank you for your business!</p>
        <p>Payment is due within 30 days. Please include invoice number on your check.</p>
    </div>
</div>
        `;

        // --- Elements ---
        const htmlInput = document.getElementById('htmlInput');
        const previewContainer = document.getElementById('preview-container');
        const downloadBtn = document.getElementById('downloadBtn');
        const btnText = document.getElementById('btnText');
        const btnSpinner = document.getElementById('btnSpinner');

        // --- Functions ---

        // 1. Initialize icons and Load Template
        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadTemplate();
        });

        function loadTemplate() {
            htmlInput.value = initialTemplate.trim();
            updatePreview();
        }

        // 2. Real-time Preview Updater
        htmlInput.addEventListener('input', updatePreview);

        function updatePreview() {
            // We use shadow DOM logic ideally, but for simple PDF gen, innerHTML is enough.
            // Note: This runs raw HTML. In a public app, you would sanitize this.
            previewContainer.innerHTML = htmlInput.value;
        }

        // 3. Visual Margins in Preview (Optional visual cue)
        function updatePreviewStyle() {
            const margin = document.getElementById('margin').value;
            previewContainer.style.padding = `${margin}mm`;
        }
        
        // Initialize padding
        updatePreviewStyle();

        // 4. PDF Generation Logic
        function generatePDF() {
            // UI Loading State
            downloadBtn.disabled = true;
            downloadBtn.classList.add('opacity-75', 'cursor-not-allowed');
            btnText.innerText = "Processing...";
            btnSpinner.classList.remove('hidden');
            
            // Get Config
            const filename = document.getElementById('filename').value || 'document.pdf';
            const margin = Number(document.getElementById('margin').value) || 10;
            const orientation = document.getElementById('orientation').value;
            const format = document.getElementById('format').value;

            // HTML2PDF Options
            const opt = {
                margin:       margin,
                filename:     filename,
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true, letterRendering: true }, // scale 2 for retina-like sharpness
                jsPDF:        { unit: 'mm', format: format, orientation: orientation }
            };

            // Select the element to convert
            const element = document.getElementById('preview-container');

            // Generate
            html2pdf()
                .set(opt)
                .from(element)
                .save()
                .then(() => {
                    // Reset UI
                    downloadBtn.disabled = false;
                    downloadBtn.classList.remove('opacity-75', 'cursor-not-allowed');
                    btnText.innerHTML = `<i data-lucide="download" class="w-4 h-4 mr-2"></i> Download PDF`;
                    btnSpinner.classList.add('hidden');
                    lucide.createIcons(); // Refresh icons if DOM shifted
                })
                .catch(err => {
                    console.error(err);
                    alert("Error generating PDF. Please check console.");
                    downloadBtn.disabled = false;
                    btnText.innerText = "Download PDF";
                    btnSpinner.classList.add('hidden');
                });
        }
    </script>
</body>
  </html>
